"use strict";function updateLightCol(a){sunlight.color.set(a)}function toggleHelper(){axisHelper.visible=scene_settings.enableHelper,grid.visible=scene_settings.enableHelper,sunlight.shadowCameraVisible=scene_settings.enableHelper,backLightHelper.visible=scene_settings.enableHelper}function adjustCC(){ccu.mulRGB.value.set(ccuEffect.mulR,ccuEffect.mulG,ccuEffect.mulB),ccu.powRGB.value.set(ccuEffect.powR,ccuEffect.powG,ccuEffect.powB)}function loadTextureCube(a,b,c){var d=[],e=new THREE.ImageLoader(loadingManager),f=new THREE.CubeTexture(d,b);f.format=THREE.RGBFormat,f.flipY=!1;for(var g=0,h=function(b){e.load(a[b],function(a){f.images[b]=a,g+=1,6===g&&(f.needsUpdate=!0,c&&c(f))})},i=0,j=a.length;j>i;i++)h(i);return f}function startScene(){setupWorld(),animateCityView()}function initDebugInfo(){var a=renderer.context;debugGL.html("Version: "+a.getParameter(a.VERSION)+"<br/>Shading language: "+a.getParameter(a.SHADING_LANGUAGE_VERSION)+"<br/>Vendor: "+a.getParameter(a.VENDOR)+"<br/>Renderer: "+a.getParameter(a.RENDERER)+"<br/>")}function updateDebugCamera(){debugCamNeedUpdate&&(debugCTGT.html("CTGT: "+cameraCtrl.target.x.toFixed(2)+", "+cameraCtrl.target.y.toFixed(2)+", "+cameraCtrl.target.z.toFixed(2)),debugCPOS.html("CPOS: "+cameraCtrl.object.position.x.toFixed(2)+", "+cameraCtrl.object.position.y.toFixed(2)+", "+cameraCtrl.object.position.z.toFixed(2)),debugFOV.html("CFOV: "+camera.fov.toFixed(2)),debugCamNeedUpdate=!1)}function render(a){requestAnimationFrame(render),stats.update(),TWEEN.update(a),animate(a),updateDebugCamera(),scene.overrideMaterial=depthMaterial,world.lensflare.visible=!1,world.sky.visible=!1,renderer.render(scene,camera,depthTarget),scene.overrideMaterial=null,world.lensflare.visible=!0,world.sky.visible=!0,composer.render()}function setupWorld(){function a(a,b){var c=assetManager.getModel(a),d=new THREE.MeshLambertMaterial({shading:THREE.FlatShading});return _.each(b,function(a,b){"map"===b||"envMap"===b?a=assetManager.getTexture(a):("color"===b||"emissive"===b)&&(a=new THREE.Color(a)),d[b]=a}),assetManager.addMaterial(a,d),c.material=d,c}function b(){return assetManager.getModel("shell").clone()}function c(){return assetManager.getModel("emptyPlatform").clone()}function d(a){var b;return _.each(world,function(c,d){c===a&&(b=d)}),b}a("emptyPlatform",{color:14540270});var e=a("shell",{color:14540270});e.castShadow=!1,e.receiveShadow=!1,world.sky=initSky(),world.lensflare=initLensflare();var f=assetManager.getModel("oceanSurface").geometry;world.ocean=initOcean(f),world.ocean.setRotationY(-Math.PI/6),world.ocean.setPosition(-760.47,97.23,1322.69),scene.add(world.ocean.oceanMesh),world.shore1=function(){var b=new THREE.Object3D,c=a("shorePlatform",{color:14540270});return c.castShadow=!1,b.add(c),b.setDefaultPos(-1400,0,805),b}(),world.shore2=function(){var a=world.shore1.clone();return a.setDefaultPos(-700,0,1215),a}(),world.shore3=function(){var a=world.shore1.clone();return a.setDefaultPos(0,0,1623),a}();var g=new THREE.Object3D,h=new THREE.Object3D,i=a("turbineBase",{color:14540270}),j=a("propeller",{color:14540270});j.position.set(0,268,-10),h.add(i),h.add(j);var k=h.clone(),l=h.clone();h.position.set(-223,90,-75),k.position.set(-22,90,40),l.position.set(175,90,153),h.rotation.y=k.rotation.y=l.rotation.y=THREE.Math.degToRad(110),g.add(h,k,l),world.shore1.add(g),world.shore1.spinTurbines=function(){h.children[1].rotation.z+=.05,k.children[1].rotation.z+=.05,l.children[1].rotation.z+=.05},world.hub=function(){var c=new THREE.Object3D,d=a("hubWindow",{map:"hubWindowTex",envMap:"reflectionCube",reflectivity:.8}),e=a("hubPlatform",{color:14540270}),f=a("hubStreetLine",{emissive:26367});f.castShadow=!1,f.receiveShadow=!1;var g=b();return c.add(g,e,d,f),c.setDefaultPos(0,0,0),c}(),world.city01=function(){var c=new THREE.Object3D,d=a("city01",{color:14540270}),e=b();return c.setDefaultPos(0,0,-808),c.add(d,e),c}(),world.city02=function(){var c=new THREE.Object3D,d=a("city02",{color:14540270}),e=b();return c.setDefaultPos(700,0,-405),c.add(d,e),c}(),world.city03=function(){var c=new THREE.Object3D,d=a("city03",{color:14540270}),e=b();return c.setDefaultPos(0,0,810),c.add(d,e),c}(),world.tollway=function(){var c=new THREE.Object3D,d=a("tollway",{color:14540270}),e=a("tollwayLine",{emissive:26367});e.castShadow=!1,e.receiveShadow=!1;var f=b();return c.setDefaultPos(-702,0,-403),c.add(d,e,f),c}(),world.landfill=function(){var d=new THREE.Object3D,e=a("landfill",{map:"landfillTex"}),f=a("landfillWindow",{map:"landfillWindowTex",envMap:"reflectionCube"}),g=a("landfillPipe",{map:"landfillPipeTex",envMap:"reflectionCube",reflectivity:.4});e.position.x=f.position.x=g.position.x=-30;var h=c(),i=b();return d.add(e,f,g,h,i),d.setDefaultPos(1400,0,-805),d}(),world.watersupply=function(){var c=new THREE.Object3D,d=a("watersupply",{color:14540270}),e=a("watersupplyPipe",{map:"watersupplyPipeTex",envMap:"reflectionCube",reflectivity:.6}),f=b();return c.add(d,e,f),c.setDefaultPos(700,0,405),c}(),world.resident1=function(){var c=new THREE.Object3D,d=a("resident01",{color:14540270}),e=b();return c.setDefaultPos(-700,0,-1213),c.rotation.y=THREE.Math.degToRad(120),c.add(d,e),c}(),world.resident2=function(){var c=new THREE.Object3D,d=a("resident02",{color:14540270}),e=b();return c.setDefaultPos(-1400,0,-809),c.add(d,e),c}(),world.resident3=function(){var a=world.resident2.clone();return a.setDefaultPos(-1400,0,-0),a.rotation.y=THREE.Math.degToRad(120),a}(),world.resident4=function(){var a=world.resident1.clone();return a.setDefaultPos(-700,0,406),a.rotation.y=THREE.Math.degToRad(0),a}(),world.eplatform1=function(){var a=new THREE.Object3D,d=c(),e=b();return a.add(d,e),a.setDefaultPos(0,0,-1618),a}(),world.eplatform2=function(){var a=world.eplatform1.clone();return a.setDefaultPos(700,0,-1211),a}(),world.eplatform3=function(){var a=world.eplatform1.clone();return a.setDefaultPos(1398,0,0),a}(),world.eplatform4=function(){var a=world.eplatform1.clone();return a.setDefaultPos(1398,0,807),a}(),world.eplatform5=function(){var a=world.eplatform1.clone();return a.setDefaultPos(700,0,1210),a}(),_.each(world,function(a){a.name=d(a),a instanceof THREE.Object3D&&scene.add(a)})}function initOcean(a){var b=2048,c=1024,d=c/2,e=0,f=0,g=new THREE.Ocean(a,renderer,camera,scene,{INITIAL_SIZE:265,INITIAL_WIND:[15,15],INITIAL_CHOPPINESS:3.7,CLEAR_COLOR:[1,1,1,0],GEOMETRY_ORIGIN:[e,f],SUN_DIRECTION:[-1,1,1],OCEAN_COLOR:new THREE.Vector3(.004,.016,.047),SKY_COLOR:new THREE.Vector3(3.2,9.6,12.8),EXPOSURE:.1,GEOMETRY_RESOLUTION:d,GEOMETRY_SIZE:b,RESOLUTION:c});g.materialOcean.uniforms.u_projectionMatrix={type:"m4",value:camera.projectionMatrix},g.materialOcean.uniforms.u_viewMatrix={type:"m4",value:camera.matrixWorldInverse},g.materialOcean.uniforms.u_cameraPosition={type:"v3",value:camera.position};var h=(new Date).getTime();g.updateOcean=function(){var a=(new Date).getTime();g.deltaTime=.001*(a-h)||0,h=a,g.render(g.deltaTime),g.overrideMaterial=g.materialOcean,g.changed&&(g.materialOcean.uniforms.u_size.value=g.size,g.materialOcean.uniforms.u_sunDirection.value.set(g.sunDirectionX,g.sunDirectionY,g.sunDirectionZ),g.materialOcean.uniforms.u_exposure.value=g.exposure,g.changed=!1),g.materialOcean.uniforms.u_normalMap.value=g.normalMapFramebuffer,g.materialOcean.uniforms.u_displacementMap.value=g.displacementMapFramebuffer,g.materialOcean.uniforms.u_projectionMatrix.value=camera.projectionMatrix,g.materialOcean.uniforms.u_viewMatrix.value=camera.matrixWorldInverse,g.materialOcean.uniforms.u_cameraPosition.value=camera.position,g.materialOcean.depthTest=!0,cameraCtrl.update()};var i=guiDebug.addFolder("Ocean"),j=i.add(g,"size",100,5e3);j.onChange(function(a){this.object.size=a,this.object.changed=!0});var k=i.add(g,"choppiness",.1,4);k.onChange(function(a){this.object.choppiness=a,this.object.changed=!0});var l=i.add(g,"windX",-15,15);l.onChange(function(a){this.object.windX=a,this.object.changed=!0});var m=i.add(g,"windY",-15,15);m.onChange(function(a){this.object.windY=a,this.object.changed=!0});var n=i.add(g,"sunDirectionX",-1,1);n.onChange(function(a){this.object.sunDirectionX=a,this.object.changed=!0});var o=i.add(g,"sunDirectionY",-1,1);o.onChange(function(a){this.object.sunDirectionY=a,this.object.changed=!0});var p=i.add(g,"sunDirectionZ",-1,1);p.onChange(function(a){this.object.sunDirectionZ=a,this.object.changed=!0});var q=i.add(g,"exposure",0,.5);return q.onChange(function(a){this.object.exposure=a,this.object.changed=!0}),g}function animate(){world.shore1.spinTurbines(),world.ocean.updateOcean()}function updateGuiSky(){for(var a in guiSky.__controllers)guiSky.__controllers[a].updateDisplay()}function updateGuiLight(){sunlightColor.color="#"+sunlight.color.getHexString();for(var a in guiDebug.__controllers)guiDebug.__controllers[a].updateDisplay()}function animateCameraTo(a,b,c){new TWEEN.Tween(cameraCtrl.target).to({x:a.x,y:a.y,z:a.z},c||1e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){cameraCtrl.update(),debugCamNeedUpdate=!0}).start(),new TWEEN.Tween(cameraCtrl.object.position).to({x:b.x,y:b.y,z:b.z},c||1e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){cameraCtrl.update(),debugCamNeedUpdate=!0}).start()}function animateFOV(a){new TWEEN.Tween(camera).to({fov:a},1e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){camera.updateProjectionMatrix(),debugCamNeedUpdate=!0}).start()}function animateSky(a,b,c,d,e,f,g,h){var i=world.sky;new TWEEN.Tween(i.ctrl).to({turbidity:a,reileigh:b,mieCoefficient:c,mieDirectionalG:d,luminance:e,inclination:f,azimuth:g},h||2e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){i.updateCtrl(),updateGuiSky()}).start()}function animateSunLightIntensity(a){new TWEEN.Tween(sunlight).to({intensity:a},3e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){updateGuiLight()}).start()}function animateClearSky(a){animateSky(2,2.7,.008,.95,.7,.7,.84,a)}function animateSunsetSky(a){animateSky(20,4,.1,.93,.35,.49,.86,a)}function animateSilhouetteSky(a){animateSky(20,.9,.067,.58,1.17,.38,.48,a)}function animateCityViewSky(a){animateSky(15,2.7,.02,.75,.79,.7,.84,a)}function animateWaterNetworkViewSky(a){animateSky(4,2,.057,.49,.22,.73,.94,a)}function resetView(){TWEEN.removeAll(),"waterNetwork"===currView&&world.watersupply.animateResetPos()}function animateCityView(){resetView(),animateCameraTo(new THREE.Vector3(-350.15,-278.71,-5.32),new THREE.Vector3(-1830.5,2112.81,-25.24)),animateFOV(80),animateCityViewSky(),animateSunLightIntensity(1),currView="city"}function animateTollwayView(){resetView(),animateCameraTo(new THREE.Vector3(-1568.77,-343.81,262.49),new THREE.Vector3(-134.94,246.37,-75.15),2e3),animateFOV(110),animateSunsetSky(3e3),animateSunLightIntensity(0,0,0),currView="tollway"}function animateLowAngleView(){resetView(),animateCameraTo(new THREE.Vector3(-31.3,581.13,372.64),new THREE.Vector3(-462.15,171.85,-245.54)),animateFOV(120),animateClearSky(),animateSunLightIntensity(1),currView="lowAngle"}function animateTurbinesView(){resetView(),animateCameraTo(new THREE.Vector3(-971.34,161.6,971.36),new THREE.Vector3(-1906.23,325.49,927.34)),animateFOV(90),animateClearSky(),animateSunLightIntensity(1),currView="turbines"}function animateLandfillView(){resetView(),animateCameraTo(new THREE.Vector3(1538.19,-314.89,245.6),new THREE.Vector3(989.74,481.44,-1133.21)),animateFOV(80),animateClearSky(),animateSunLightIntensity(1),currView="landfill"}function animateWaterNetworkView(){resetView(),animateCameraTo(new THREE.Vector3(832.43,397.33,697.43),new THREE.Vector3(21.29,694.72,666.29)),animateFOV(80),animateWaterNetworkViewSky(),animateSunLightIntensity(1),world.watersupply.animateY(700),currView="waterNetwork"}function animateSilhouetteView(){resetView(),animateCameraTo(new THREE.Vector3(-95.51,697.74,17.04),new THREE.Vector3(-16988.94,308.43,1143.06),100),animateFOV(5),animateSilhouetteSky(100),animateSunLightIntensity(1),currView="silhouette"}function initSky(){var a=new THREE.Sky,b=new THREE.Mesh(new THREE.SphereGeometry(2e4,30,30),new THREE.MeshBasicMaterial({color:16777215,wireframe:!1}));b.position.y=-7e5,scene.add(b),a.mesh.ctrl={turbidity:18.9,reileigh:4,mieCoefficient:.063,mieDirectionalG:.94,luminance:.35,inclination:.86,azimuth:.9,sun:!1};var c=4e5;return a.mesh.changeSetting=function(b,c,d,e,f,g,h){a.mesh.ctrl.turbidity=b,a.mesh.ctrl.reileigh=c,a.mesh.ctrl.mieCoefficient=d,a.mesh.ctrl.mieDirectionalG=e,a.mesh.ctrl.luminance=f,a.mesh.ctrl.inclination=g,a.mesh.ctrl.azimuth=h},a.mesh.updateCtrl=function(){var d=a.uniforms;d.turbidity.value=a.mesh.ctrl.turbidity,d.reileigh.value=a.mesh.ctrl.reileigh,d.luminance.value=a.mesh.ctrl.luminance,d.mieCoefficient.value=a.mesh.ctrl.mieCoefficient,d.mieDirectionalG.value=a.mesh.ctrl.mieDirectionalG;var e=Math.PI*(a.mesh.ctrl.inclination-.5),f=2*Math.PI*(a.mesh.ctrl.azimuth-.5);b.position.x=c*Math.cos(f),b.position.y=c*Math.sin(f)*Math.sin(e),b.position.z=c*Math.sin(f)*Math.cos(e),b.visible=a.mesh.ctrl.sun,a.uniforms.sunPosition.value.copy(b.position),a.mesh.sunPosition=b.position;var g=1e4;e+=.2,sunlight.position.x=g*Math.cos(f),sunlight.position.y=g*Math.sin(f)*Math.sin(e),sunlight.position.z=g*Math.sin(f)*Math.cos(e)},guiSky=guiDebug.addFolder("Sky"),guiSky.add(a.mesh.ctrl,"turbidity",1,20,.1).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"reileigh",0,4,.001).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"mieCoefficient",0,.1,.001).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"mieDirectionalG",0,1,.001).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"luminance",0,2).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"inclination",0,1,1e-4).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"azimuth",0,1,1e-4).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"sun").onChange(a.mesh.updateCtrl),a.mesh.updateCtrl(),a.mesh}function initLensflare(){function a(a){var b=world.sky.sunPosition.clone();"tollway"===currView&&(b.y+=5e4),a.position.copy(b);var c,d=2*-a.positionScreen.x,e=2*-a.positionScreen.y,f=a.lensFlares.length;for(c=0;f>c;c++){var g=a.lensFlares[c];g.rotation=0,c>0&&(g.x=a.positionScreen.x+d*g.distance,g.y=a.positionScreen.y+e*g.distance)}}var b=new THREE.LensFlare(assetManager.getTexture("lensdirtTex"),2048,0,THREE.AdditiveBlending,new THREE.Color(4473924));return b.add(assetManager.getTexture("lensFlare01Tex"),1024,0,THREE.AdditiveBlending,new THREE.Color(8947848)),b.position.copy(sunlight.position),b.customUpdateCallback=a,b}function onWindowResize(){screenWidth=window.innerWidth,screenHeight=window.innerHeight,camera.aspect=screenWidth/screenHeight,camera.updateProjectionMatrix(),renderer.setSize(screenWidth,screenHeight),FXAApass.uniforms.resolution.value.set(1/(screenWidth*dpr),1/(screenHeight*dpr)),composer.setSize(screenWidth*dpr,screenHeight*dpr)}function onDocumentMouseMove(a){a.preventDefault(),mouse.x=a.clientX/screenWidth*2-1,mouse.y=2*-(a.clientY/screenHeight)+1}THREE.Object3D.prototype.clone=function(a,b){if(void 0===a&&(a=new THREE.Object3D),void 0===b&&(b=!0),a.name=this.name,a.up.copy(this.up),a.position.copy(this.position),a.quaternion.copy(this.quaternion),a.scale.copy(this.scale),a.renderDepth=this.renderDepth,a.rotationAutoUpdate=this.rotationAutoUpdate,a.matrix.copy(this.matrix),a.matrixWorld.copy(this.matrixWorld),a.matrixAutoUpdate=this.matrixAutoUpdate,a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,a.material&&this.material&&(a.material=this.material.clone()),a.visible=this.visible,a.castShadow=this.castShadow,a.receiveShadow=this.receiveShadow,a.frustumCulled=this.frustumCulled,a.userData=JSON.parse(JSON.stringify(this.userData)),b===!0)for(var c=0;c<this.children.length;c++){var d=this.children[c];a.add(d.clone())}return a},THREE.Object3D.prototype.setDefaultPos=function(a,b,c,d,e,f){this.position.set(a,b,c),this.oripos=this.position.clone(),this.orirot=this.rotation.clone(),d&&e&&f&&(this.rotation.set(d,e,f),this.orirot=this.rotation.clone())},THREE.Object3D.prototype.animateResetPos=function(){new TWEEN.Tween(this.position).to({x:this.oripos.x,y:this.oripos.y,z:this.oripos.z},1e3).easing(TWEEN.Easing.Quadratic.Out).start(),new TWEEN.Tween(this.rotation).to({x:this.orirot.x,y:this.orirot.y,z:this.orirot.z},1e3).easing(TWEEN.Easing.Quadratic.Out).start()},THREE.Object3D.prototype.animatePos=function(a,b,c){new TWEEN.Tween(this.position).to({x:a,y:b,z:c},1e3).easing(TWEEN.Easing.Quadratic.Out).start()},THREE.Object3D.prototype.animateY=function(a){new TWEEN.Tween(this.position).to({y:a},1e3).easing(TWEEN.Easing.Quadratic.Out).start()};var container,stats,scene,camera,cameraCtrl,renderer,world={},screenWidth=window.innerWidth,screenHeight=window.innerHeight,dpr=1;void 0!==window.devicePixelRatio&&(dpr=window.devicePixelRatio);var mouse=new THREE.Vector2(-1,-1),scene_settings={enableHelper:!1,bgColor:1118483,enableShadow:!0,shadowMapType:THREE.PCFSoftShadowMap,shadowMapSize:4096,maxAnisotropy:null};container=document.getElementById("canvas-container"),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(80,window.innerWidth/window.innerHeight,10,2e6),cameraCtrl=new THREE.OrbitControls(camera,container),cameraCtrl.object.position.set(-3e3,2e3,0),cameraCtrl.update(),renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),renderer.setClearColor(scene_settings.bgColor,1),renderer.setSize(window.innerWidth,window.innerHeight),renderer.shadowMapEnabled=scene_settings.enableShadow,renderer.shadowMapType=scene_settings.shadoyMapType,scene_settings.maxAnisotropy=scene_settings.maxAnisotropy||renderer.getMaxAnisotropy(),container.appendChild(renderer.domElement),stats=new Stats,container.appendChild(stats.domElement);var grid=new THREE.GridHelper(4e3,500);grid.setColors(16746496,0),grid.material.opacity=.7,grid.material.transparent=!0,grid.position.y=-300,scene.add(grid);var axisHelper=new THREE.AxisHelper(1e3);axisHelper.position.y=1e3,scene.add(axisHelper);var gui=new dat.GUI,guiCtrl=gui.addFolder("Controls"),guiViews=guiCtrl.addFolder("Views"),guiDebug=gui.addFolder("Debug"),guiSky;gui.open(),guiCtrl.open(),guiViews.open(),guiDebug.open();var debugInfo=$(".debug-info"),statsDOM=$("#stats"),toggleDebugInfo={value:!0};guiDebug.add(toggleDebugInfo,"value").name("System Info").onChange(function(a){a?(debugInfo.css("visibility","visible"),statsDOM.css("visibility","visible")):(debugInfo.css("visibility","hidden"),statsDOM.css("visibility","hidden"))}),guiDebug.add(scene_settings,"enableHelper").name("Visual Helper").onChange(toggleHelper);var SHADOW_MAP_WIDTH=scene_settings.shadowMapSize,SHADOW_MAP_HEIGHT=scene_settings.shadowMapSize,sunlight=new THREE.DirectionalLight(16777215,1);sunlight.castShadow=!0,sunlight.shadowCameraNear=8e3,sunlight.shadowCameraFar=12e3,sunlight.shadowCameraLeft=-2e3,sunlight.shadowCameraRight=2e3,sunlight.shadowCameraTop=2e3,sunlight.shadowCameraBottom=-2e3,sunlight.shadowCameraVisible=!0,sunlight.shadowCameraFov=80,sunlight.shadowBias=1e-4,sunlight.shadowDarkness=.77,sunlight.shadowMapWidth=SHADOW_MAP_WIDTH,sunlight.shadowMapHeight=SHADOW_MAP_HEIGHT;var sunlightColor={color:"#ffffff"},guiSunlight=guiDebug.addFolder("Sunlight");guiSunlight.add(sunlight,"intensity",0,2,.1),guiSunlight.addColor(sunlightColor,"color").name("color").onChange(updateLightCol),scene.add(sunlight);var backLight=new THREE.DirectionalLight(16777215,.5);backLight.position.set(1e3,1e3,-1500);var backLightHelper=new THREE.DirectionalLightHelper(backLight,100);scene.add(backLightHelper),scene.add(backLight);var ambLight=new THREE.AmbientLight(328966);scene.add(ambLight),toggleHelper();var renderPass=new THREE.RenderPass(scene,camera),depthShader=THREE.ShaderLib.depthRGBA,depthUniforms=THREE.UniformsUtils.clone(depthShader.uniforms),depthMaterial=new THREE.ShaderMaterial({fragmentShader:depthShader.fragmentShader,vertexShader:depthShader.vertexShader,uniforms:depthUniforms});depthMaterial.blending=THREE.NoBlending;var depthTarget=new THREE.WebGLRenderTarget(1024,1024,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),SSAOpass=new THREE.ShaderPass(THREE.SSAOShader);SSAOpass.uniforms.tDepth.value=depthTarget,SSAOpass.uniforms.size.value.set(1024,1024),SSAOpass.uniforms.cameraNear.value=camera.near,SSAOpass.uniforms.cameraFar.value=1e4,SSAOpass.uniforms.aoClamp.value=.45,SSAOpass.uniforms.lumInfluence.value=.7,SSAOpass.uniforms.onlyAO.value=0;var FXAApass=new THREE.ShaderPass(THREE.FXAAShader);FXAApass.uniforms.resolution.value.set(1/(screenWidth*dpr),1/(screenHeight*dpr));var CCpass=new THREE.ShaderPass(THREE.ColorCorrectionShader),CCNIXpass=new THREE.ShaderPass(THREE.ColorCorrectionShaderNIX),copyPass=new THREE.ShaderPass(THREE.CopyShader);copyPass.renderToScreen=!0;var composer=new THREE.EffectComposer(renderer);composer.setSize(screenWidth*dpr,screenHeight*dpr),composer.addPass(renderPass),composer.addPass(SSAOpass),composer.addPass(FXAApass),composer.addPass(CCpass),composer.addPass(CCNIXpass),composer.addPass(copyPass);var guiPP=guiDebug.addFolder("Post-Processing");guiPP.open(),guiPP.add(FXAApass,"enabled").name("FXAA");var onlyAO={value:!1},guiSSAO=guiPP.addFolder("SSAO");guiSSAO.add(SSAOpass,"enabled").name("Enable"),guiSSAO.add(onlyAO,"value").name("Show RAW").onChange(function(a){SSAOpass.uniforms.onlyAO.value=a?1:0}),guiSSAO.add(SSAOpass.uniforms.aoClamp,"value",0,1).name("Clamp"),guiSSAO.add(SSAOpass.uniforms.lumInfluence,"value",-2,2).name("LumInfluence");var guiBleach=guiPP.addFolder("Bleach Bypass & E6C41");guiBleach.add(CCNIXpass,"enabled").name("Enable"),guiBleach.add(CCNIXpass.uniforms.uOpacity,"value",0,2,.1).name("Bleach Bypass"),guiBleach.add(CCNIXpass.uniforms.uOpacity2,"value",0,2,.1).name("E6C41");var ccu=CCpass.uniforms,ccuEffect={powR:1.15,powG:1.15,powB:1.1,mulR:1.3,mulG:1.3,mulB:1.3},guiCC=guiPP.addFolder("Color Correction");guiCC.add(CCpass,"enabled").name("Enable"),guiCC.add(ccuEffect,"powR",1,3,.01).onChange(adjustCC),guiCC.add(ccuEffect,"powG",1,3,.01).onChange(adjustCC),guiCC.add(ccuEffect,"powB",1,3,.01).onChange(adjustCC),guiCC.add(ccuEffect,"mulR",1,3,.01).onChange(adjustCC),guiCC.add(ccuEffect,"mulG",1,3,.01).onChange(adjustCC),guiCC.add(ccuEffect,"mulB",1,3,.01).onChange(adjustCC),adjustCC();var assetManager=function(){function a(a,b){var c;return-1!==b.indexOf(i)&&(c=l.textures[a]={},c.texUrl=h+b,c.texture=null),-1!==b.indexOf(k)&&(c=l.models[a]={},c.modelUrl=j+b,c.model=null),this}function b(){return l}function c(a){return l.models[a].model}function d(a){return l.textures[a].texture}function e(a){return l.materials[a]}function f(a,b){return l.textures[a]={},l.textures[a].texture=b,this}function g(a,b){return l.materials[a]=b,this}var h="assets/",i=".png",j="assets/",k=".obj",l={textures:{},models:{},materials:{}};return{addFile:a,get:b,getModel:c,getTexture:d,getMaterial:e,addMaterial:g,addTexture:f}}();assetManager.addFile("emptyPlatform","platform/emptyPlatform.obj").addFile("shell","platform/platformShell.obj").addFile("shorePlatform","shore/shoreSlope.obj").addFile("shoreWaterSurfaceTex","shore/1024shoreWaterSurface.png").addFile("shoreWaterSurface","shore/shoreWaterSurface.obj").addFile("turbineBase","turbine/turbineBase.obj").addFile("propeller","turbine/propeller.obj").addFile("hubPlatform","hub/hubplatform.obj").addFile("hubWindowTex","hub/1024hubwindow.png").addFile("hubWindow","hub/hubwindow.obj").addFile("hubStreetLine","hub/hubstreetline.obj").addFile("city01","city01/city01.obj").addFile("tollway","tollway/tollway.obj").addFile("tollwayLine","tollway/tollwayline.obj").addFile("city02","city02/city02.obj").addFile("city03","city03/city03.obj").addFile("resident01","resident01/resident01.obj").addFile("resident02","resident02/resident02.obj").addFile("landfillTex","landfill/1024landfill.png").addFile("landfill","landfill/landfill.obj").addFile("landfillPipeTex","landfill/1024landfillPipe.png").addFile("landfillPipe","landfill/landfillPipe.obj").addFile("landfillWindowTex","landfill/1024landfillWindow.png").addFile("landfillWindow","landfill/landfillWindow.obj").addFile("watersupply","watersupply/watersupply.obj").addFile("watersupplyPipeTex","watersupply/1024watersupplyPipe.png").addFile("watersupplyPipe","watersupply/watersupplyPipe.obj").addFile("lensdirtTex","lensflare/lensdirt01.png").addFile("lensFlare01Tex","lensflare/lensflare01.png").addFile("oceanSurface","ocean/oceanSurfaceSubdivided.obj");var loadingBar=$("#loading"),totalItems,loadedItems,loadingManager=new THREE.LoadingManager;console.time("loadingManager"),loadingManager.onProgress=function(a,b,c){totalItems=c,loadedItems=b;var d=b/c*100;loadingBar.css("width",d+"%")},loadingManager.onError=function(){console.error("Error: loading assets")},loadingManager.onLoad=function(){console.log(loadedItems+"/"+totalItems+" assets loaded"),console.timeEnd("loadingManager"),loadingBar.css("display","none"),startScene(),initDebugInfo(),render()};var textureLoader=new THREE.ImageLoader(loadingManager),OBJloader=new THREE.OBJLoader(loadingManager);_.each(assetManager.get().textures,function(a){textureLoader.load(a.texUrl,function(b){a.texture=new THREE.Texture(b),a.texture.needsUpdate=!0})}),_.each(assetManager.get().models,function(a){OBJloader.load(a.modelUrl,function(b){a.model=b.children[0],a.model.geometry.computeVertexNormals(),a.model.receiveShadow=!0,a.model.castShadow=!0})});var path="assets/skybox/",format=".bmp",urls=[path+"px"+format,path+"nx"+format,path+"py"+format,path+"ny"+format,path+"pz"+format,path+"nz"+format],reflectionCube=loadTextureCube(urls);assetManager.addTexture("reflectionCube",reflectionCube);var debugCTGT=$(".ctgt"),debugCPOS=$(".cpos"),debugFOV=$(".fov"),debugGL=$(".debug-gl"),debugCamNeedUpdate=!1,currView="city",viewCtrl={silhouette:animateSilhouetteView,city:animateCityView,turbines:animateTurbinesView,landfill:animateLandfillView,waterNetwork:animateWaterNetworkView,tollway:animateTollwayView,lowAngle:animateLowAngleView};guiViews.add(viewCtrl,"silhouette"),guiViews.add(viewCtrl,"city"),guiViews.add(viewCtrl,"turbines"),guiViews.add(viewCtrl,"landfill"),guiViews.add(viewCtrl,"waterNetwork"),guiViews.add(viewCtrl,"tollway"),guiViews.add(viewCtrl,"lowAngle"),window.addEventListener("keypress",function(a){32===a.keyCode&&(a.preventDefault(),gui.closed=!gui.closed),102===a.keyCode&&(a.preventDefault(),THREEx.FullScreen.request())}),window.addEventListener("resize",onWindowResize,!1),document.addEventListener("mousemove",onDocumentMouseMove,!1);
//# sourceMappingURL=smart-city-app.min.js.map