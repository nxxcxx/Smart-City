"use strict";function initDebugInfo(){function a(a){var b={renderer:"",vendor:""},c=a.getExtension("WEBGL_debug_renderer_info");return null!==c&&(b.renderer=a.getParameter(c.UNMASKED_RENDERER_WEBGL),b.vendor=a.getParameter(c.UNMASKED_VENDOR_WEBGL)),b}var b=renderer.getContext(),c={Platform:navigator.platform,Version:b.getParameter(b.VERSION),ShadingLanguage:b.getParameter(b.SHADING_LANGUAGE_VERSION),Vendor:b.getParameter(b.VENDOR),Renderer:b.getParameter(b.RENDERER),unMaskedVendor:a(b).vendor,unMaskedRenderer:a(b).renderer,Antialias:b.getContextAttributes().antialias?"Available":"Not available",maxTextureSize:b.getParameter(b.MAX_TEXTURE_SIZE),maxCubeMapTextureSize:b.getParameter(b.MAX_CUBE_MAP_TEXTURE_SIZE),maxAnisotropy:renderer.getMaxAnisotropy()};console.log(c);var d="";_.each(c,function(a,b){d+=b+": "+a+" | "}),debugGL.html(d)}function updateDebugCamera(){if(scene_settings.enableInfoBar){var a=cameraCtrl.target,b=cameraCtrl.object.position;debugCTGT.html("CTGT: "+a.x.toFixed(2)+", "+a.y.toFixed(2)+", "+a.z.toFixed(2)),debugCPOS.html("CPOS: "+b.x.toFixed(2)+", "+b.y.toFixed(2)+", "+b.z.toFixed(2)),debugFOV.html("CFOV: "+camera.fov.toFixed(2))}}function updateLightCol(a){sunlight.color.set(a)}function toggleHelper(){axisHelper.visible=scene_settings.enableHelper,grid.visible=scene_settings.enableHelper,sunlight.shadowCameraVisible=scene_settings.enableHelper,backLightHelper.visible=scene_settings.enableHelper}function adjustCC(){ccu.mulRGB.value.set(ccuEffect.mulR,ccuEffect.mulG,ccuEffect.mulB),ccu.powRGB.value.set(ccuEffect.powR,ccuEffect.powG,ccuEffect.powB)}function loadTextureCube(a,b,c){var d=[],e=new THREE.ImageLoader(loadingManager),f=new THREE.CubeTexture(d,b);f.format=THREE.RGBFormat,f.flipY=!1;for(var g=0,h=function(b){e.load(a[b],function(a){f.images[b]=a,g+=1,6===g&&(f.needsUpdate=!0,c&&c(f))})},i=0,j=a.length;j>i;i++)h(i);return f}function initContent(){new SlideShow("#photo-bipv"),new SlideShow("#photo-sensor")}function startScene(){setupWorld(),animateCityView()}function mapToRange(a,b,c,d,e){return(a-b)/(c-b)*(e-d)+d}function render(a){requestAnimationFrame(render),TWEEN.update(a),animate(a),world.beacon.uniforms.time.value=a,updateDebugCamera(),scene.overrideMaterial=depthMaterial,world.lensflare.visible=!1,world.sky.visible=!1,world.ocean&&(world.ocean.oceanMesh.visible=!1),world.skybox.visible=!1,world.beacon.visible=!1,renderer.render(scene,camera,depthTarget,!0),scene.overrideMaterial=null,world.lensflare.visible=!0,world.sky.visible=!0,world.ocean&&(world.ocean.oceanMesh.visible=!0),world.skybox.visible=!0,world.beacon.visible=!0,composer.render(),stats.update()}function setupWorld(){function a(a,b){var c=assetManager.getModel(a),d=new THREE.MeshLambertMaterial({shading:THREE.FlatShading});return _.each(b,function(a,b){"map"===b||"envMap"===b?a=assetManager.getTexture(a):("color"===b||"emissive"===b)&&(a=new THREE.Color(a)),d[b]=a}),assetManager.addMaterial(a,d),c.material=d,c}function b(){return assetManager.getModel("shell").clone()}function c(){return assetManager.getModel("emptyPlatform").clone()}function d(a){var b;return _.each(world,function(c,d){c===a&&(b=d)}),b}var e=14540270;a("emptyPlatform",{color:e});var f=a("shell",{color:e});f.castShadow=!1,f.receiveShadow=!1,world.sky=initSky(),world.lensflare=initLensflare();var g=THREE.ShaderLib.cube;g.uniforms.tCube.value=assetManager.getTexture("reflectionCube");var h=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:g.uniforms,side:THREE.BackSide,depthWrite:!1,blending:THREE.MultiplyBlending,transparent:!0,opacity:1});world.skybox=new THREE.Mesh(new THREE.BoxGeometry(1e6,1e6,1e6),h);var i={time:{type:"f",value:0}},j=new THREE.ShaderMaterial({uniforms:i,vertexShader:document.getElementById("vPulse").textContent,fragmentShader:document.getElementById("fPulse").textContent,side:THREE.DoubleSide,transparent:!0,depthWrite:!1}),k=new THREE.PlaneBufferGeometry(1024,1024,1,1);k.applyMatrix((new THREE.Matrix4).makeRotationX(.5*-Math.PI));var l=new THREE.Mesh(k,j);l.position.set(772,670,533),world.beacon=l,world.beacon.uniforms=i;var m=assetManager.getModel("oceanSurface").geometry;world.ocean=initOcean(m),world.ocean.setRotationY(-Math.PI/6),world.ocean.setPosition(-760.47,97.23,1322.69),scene.add(world.ocean.oceanMesh),world.shore1=function(){var b=new THREE.Object3D,c=a("shorePlatform",{color:e});return c.castShadow=!1,b.add(c),b.setDefaultPos(-1400,0,808),b}(),world.shore2=function(){var a=world.shore1.clone();return a.setDefaultPos(-700,0,1214),a}(),world.shore3=function(){var a=world.shore1.clone();return a.setDefaultPos(0,0,1618),a}();var n=new THREE.Object3D,o=new THREE.Object3D,p=a("turbineBase",{color:e}),q=a("propeller",{color:e});q.position.set(0,370.5,-10),o.add(p),o.add(q);var r=o.clone(),s=o.clone();o.position.set(-223,40,-75),r.position.set(-22,40,40),s.position.set(175,40,153),o.rotation.y=r.rotation.y=s.rotation.y=THREE.Math.degToRad(110),n.add(o,r,s),world.shore1.add(n),world.shore1.spinTurbines=function(){o.children[1].rotation.z+=.05,r.children[1].rotation.z+=.05,s.children[1].rotation.z+=.05},world.hub=function(){var d=new THREE.Object3D,f=a("hubWindow",{map:"hubWindowTex",envMap:"reflectionCube",reflectivity:.8}),g=a("hubPlatform",{color:e}),h=a("hubStreetLine",{emissive:43775});h.castShadow=!1,h.receiveShadow=!1;var i=c(),j=b();return d.add(j,g,f,h,i),d.setDefaultPos(0,0,0),d}(),world.city01=function(){var d=new THREE.Object3D,f=a("city01",{color:e}),g=b(),h=c();return d.setDefaultPos(0,0,-808),d.add(f,g,h),d}(),world.city02=function(){var d=new THREE.Object3D,f=a("city02",{color:e}),g=b(),h=c();return d.setDefaultPos(700,0,-405),d.add(f,g,h),d}(),world.city03=function(){var d=new THREE.Object3D,f=a("city03",{color:e}),g=b(),h=c();return d.setDefaultPos(0,0,810),d.add(f,g,h),d}(),world.tollway=function(){var d=new THREE.Object3D,f=a("tollway",{color:e}),g=a("tollwayLine",{emissive:43775});g.castShadow=!1,g.receiveShadow=!1;var h=c(),i=b();return d.setDefaultPos(-702,0,-403),d.add(f,g,i,h),d}(),world.landfill=function(){var d=new THREE.Object3D,e=a("landfillBuilding",{map:"landfillBuildingTex"}),f=a("landfillDirt",{map:"landfillDirtTex"}),g=a("landfillWindow",{map:"landfillWindowTex",envMap:"reflectionCube"}),h=a("landfillPipe",{map:"landfillPipeTex",envMap:"reflectionCube",reflectivity:.4});e.position.x=g.position.x=h.position.x=-30;var i=c(),j=b();return d.add(e,f,g,h,i,j),d.setDefaultPos(1400,0,-805),d}(),world.watersupply=function(){var d=new THREE.Object3D,f=a("watersupply",{color:e}),g=a("watersupplyPipe",{map:"watersupplyPipeTex",envMap:"reflectionCube",reflectivity:.6}),h=b(),i=c();return d.add(f,g,h,i),d.setDefaultPos(700,0,405),d}(),world.resident1=function(){var d=new THREE.Object3D,f=a("resident01",{color:e}),g=c(),h=b();return d.setDefaultPos(-700,0,-1213),d.rotation.y=THREE.Math.degToRad(120),d.add(f,h,g),d}(),world.resident2=function(){var d=new THREE.Object3D,f=a("resident02",{color:e}),g=b(),h=c();return d.setDefaultPos(-1400,0,-809),d.add(f,g,h),d}(),world.resident3=function(){var a=world.resident2.clone();return a.setDefaultPos(-1400,0,-0),a.rotation.y=THREE.Math.degToRad(120),a}(),world.resident4=function(){var a=world.resident1.clone();return a.setDefaultPos(-700,0,406),a.rotation.y=THREE.Math.degToRad(0),a}(),world.eplatform1=function(){var a=new THREE.Object3D,d=c(),e=b();return a.add(d,e),a.setDefaultPos(0,0,-1618),a}(),world.eplatform2=function(){var a=world.eplatform1.clone();return a.setDefaultPos(700,0,-1211),a}(),world.eplatform3=function(){var a=world.eplatform1.clone();return a.setDefaultPos(1398,0,0),a}(),world.eplatform4=function(){var a=world.eplatform1.clone();return a.setDefaultPos(1398,0,807),a}(),world.eplatform5=function(){var a=world.eplatform1.clone();return a.setDefaultPos(700,0,1210),a}(),_.each(world,function(a){a.name=d(a),a instanceof THREE.Object3D&&scene.add(a)})}function animate(){world.shore1.spinTurbines(),world.ocean&&world.ocean.updateOcean()}function updateGuiSky(){for(var a in guiSky.__controllers)guiSky.__controllers[a].updateDisplay()}function updateGuiLight(){sunlightColor.color="#"+sunlight.color.getHexString();for(var a in guiSunlight.__controllers)guiSunlight.__controllers[a].updateDisplay()}function updateGuiOcean(){for(var a in guiOcean.__controllers)guiOcean.__controllers[a].updateDisplay()}function setCamera(a,b){cameraCtrl.target.copy(a),cameraCtrl.object.position.copy(b)}function animateCameraTo(a,b,c,d){new TWEEN.Tween(cameraCtrl.target).to({x:a.x,y:a.y,z:a.z},c||1e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){cameraCtrl.update()}).start(),new TWEEN.Tween(cameraCtrl.object.position).to({x:b.x,y:b.y,z:b.z},c||1e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){cameraCtrl.update()}).start().onComplete(function(){d&&d()})}function animateFOV(a,b){new TWEEN.Tween(camera).to({fov:a},b||1e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){camera.updateProjectionMatrix()}).start()}function animateSky(a,b,c,d,e,f,g,h){var i=world.sky;new TWEEN.Tween(i.ctrl).to({turbidity:a,reileigh:b,mieCoefficient:c,mieDirectionalG:d,luminance:e,inclination:f,azimuth:g},h||2e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){i.updateCtrl(),updateGuiSky()}).start()}function animateSunLightIntensity(a){new TWEEN.Tween(sunlight).to({intensity:a},3e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){updateGuiLight()}).start()}function animateFrontLightIntensity(a){new TWEEN.Tween(frontLight).to({intensity:a},3e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){}).start()}function animateBackLightIntensity(a){new TWEEN.Tween(backLight).to({intensity:a},3e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){}).start()}function animateClearSky(a){animateSky(33,2,.088,.07,.13,.65,.83,a)}function animateSunsetSky(a){animateSky(20,4,.1,.93,.35,.49,.86,a)}function animateSilhouetteSky(a){animateSky(20,.9,.067,.58,1.17,.38,.48,a)}function animateCityViewSky(a){animateSky(20,.1,.1,0,.02,.72,.83,a)}function animateWaterNetworkViewSky(a){animateSky(4,2,.057,.49,.22,.73,.94,a)}function animateTurbineViewSky(a){animateSky(40,1.4,.1,.64,.25,.68,.58,a)}function animateLandfillViewSky(a){animateSky(18,1.9,.009,.74,.7,1,.91,a)}function animateOceanExposure(a){world.ocean&&new TWEEN.Tween(world.ocean).to({exposure:a},1e3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){world.ocean.changed=!0,updateGuiOcean()}).start()}function resetView(){TWEEN.removeAll(),animateContentOut(),animateOceanExposure(.2),animateFrontLightIntensity(0),animateBackLightIntensity(.5),world.watersupply.animateResetPos(),world.beacon.visible=!1}function animateCityView(){resetView(),animateCameraTo(new THREE.Vector3(-350.15,-278.71,-5.32),new THREE.Vector3(-1830.5,2112.81,-25.24)),animateFOV(80),animateCityViewSky(),animateSunLightIntensity(1),currView="city"}function animateSensorView(){resetView(),animateContentIn("#sensor"),animateCameraTo(new THREE.Vector3(179.74,-157.19,77.1),new THREE.Vector3(1175.8,1175.81,-181.75)),animateFOV(80),animateCityViewSky(),animateSunLightIntensity(1),world.beacon.visible=!0,currView="city"}function animateTollwayView(){resetView(),animateCameraTo(new THREE.Vector3(-1568.77,-343.81,262.49),new THREE.Vector3(-134.94,246.37,-75.15),2e3),animateFOV(110),animateSunsetSky(3e3),animateSunLightIntensity(0,0,0),animateBackLightIntensity(.1),animateOceanExposure(.01),currView="tollway"}function animateHubView(){resetView(),animateContentIn("#bipv"),animateCameraTo(new THREE.Vector3(-31.3,581.13,372.64),new THREE.Vector3(-462.15,171.85,-245.54)),animateFOV(120),animateClearSky(),animateSunLightIntensity(1),currView="lowAngle"}function animateTurbinesView(){resetView(),animateCameraTo(new THREE.Vector3(-954.99,251.94,957.54),new THREE.Vector3(-1894.62,378.96,1018.93)),animateFOV(90),animateTurbineViewSky(500),animateSunLightIntensity(1),animateFrontLightIntensity(2),animateOceanExposure(.1),currView="turbines"}function animateLandfillView(){resetView(),animateCameraTo(new THREE.Vector3(1426.91,-334.68,267.19),new THREE.Vector3(1035.25,410.91,-1191.15)),animateFOV(80),animateClearSky(),animateLandfillViewSky(),animateSunLightIntensity(1.6),currView="landfill"}function animateWaterNetworkView(){resetView(),animateCameraTo(new THREE.Vector3(832.43,397.33,697.43),new THREE.Vector3(21.29,694.72,666.29)),animateFOV(80),animateWaterNetworkViewSky(),animateSunLightIntensity(2),world.watersupply.animateY(700),currView="waterNetwork"}function animateSilhouetteView(){resetView(),animateCameraTo(new THREE.Vector3(-95.51,697.74,17.04),new THREE.Vector3(-16988.94,308.43,1143.06),100),animateFOV(5),animateSilhouetteSky(100),animateSunLightIntensity(1),animateOceanExposure(.01),currView="silhouette"}function animateContentOut(){contentBar.children().stop().fadeOut({queue:!1,duration:500})}function animateContentIn(a){$(a).stop().fadeIn({queue:!1,duration:500})}function SlideShow(a){this._imgArr=$(a).children(),this._currIdx=1,this._timeout=null,this.duration=1e3,this.delay=1500,this.auto=!0,this.start()}function animateCameraRotateLeft(a,b){var c={value:0};new TWEEN.Tween(c).to({value:1},a||1e4).easing(TWEEN.Easing.Linear.None).onUpdate(function(){cameraCtrl.rotateLeft(b||35e-5)}).start()}function animateCameraRotateUp(a,b){var c={value:0};new TWEEN.Tween(c).to({value:1},a||1e4).easing(TWEEN.Easing.Linear.None).onUpdate(function(){cameraCtrl.rotateUp(b||35e-5)}).start()}function initSky(){var a=new THREE.Sky,b=new THREE.Mesh(new THREE.SphereGeometry(2e4,30,30),new THREE.MeshBasicMaterial({color:16777215,wireframe:!1}));b.position.y=-7e5,scene.add(b),a.mesh.ctrl={turbidity:18.9,reileigh:4,mieCoefficient:.063,mieDirectionalG:.94,luminance:.35,inclination:.86,azimuth:.9,sun:!1};var c=4e5;return a.mesh.changeSetting=function(b,c,d,e,f,g,h){a.mesh.ctrl.turbidity=b,a.mesh.ctrl.reileigh=c,a.mesh.ctrl.mieCoefficient=d,a.mesh.ctrl.mieDirectionalG=e,a.mesh.ctrl.luminance=f,a.mesh.ctrl.inclination=g,a.mesh.ctrl.azimuth=h},a.mesh.updateCtrl=function(){var d=a.uniforms;d.turbidity.value=a.mesh.ctrl.turbidity,d.reileigh.value=a.mesh.ctrl.reileigh,d.luminance.value=a.mesh.ctrl.luminance,d.mieCoefficient.value=a.mesh.ctrl.mieCoefficient,d.mieDirectionalG.value=a.mesh.ctrl.mieDirectionalG;var e=Math.PI*(a.mesh.ctrl.inclination-.5),f=2*Math.PI*(a.mesh.ctrl.azimuth-.5);b.position.x=c*Math.cos(f),b.position.y=c*Math.sin(f)*Math.sin(e),b.position.z=c*Math.sin(f)*Math.cos(e),b.visible=a.mesh.ctrl.sun,a.uniforms.sunPosition.value.copy(b.position),a.mesh.sunPosition=b.position;var g=1e4;e+=.2,sunlight.position.x=g*Math.cos(f),sunlight.position.y=g*Math.sin(f)*Math.sin(e),sunlight.position.z=g*Math.sin(f)*Math.cos(e)},guiSky=guiDebug.addFolder("Sky"),guiSky.add(a.mesh.ctrl,"turbidity",1,40,.1).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"reileigh",0,4,.001).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"mieCoefficient",0,.1,.001).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"mieDirectionalG",0,1,.001).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"luminance",0,2).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"inclination",0,1,1e-4).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"azimuth",0,1,1e-4).onChange(a.mesh.updateCtrl),guiSky.add(a.mesh.ctrl,"sun").onChange(a.mesh.updateCtrl),a.mesh.updateCtrl(),a.mesh}function initOcean(a){var b=1024,c=0,d=0,e=new THREE.Ocean(a,renderer,camera,scene,{INITIAL_SIZE:265,INITIAL_WIND:[15,15],INITIAL_CHOPPINESS:3.7,CLEAR_COLOR:[1,1,1,0],GEOMETRY_ORIGIN:[c,d],SUN_DIRECTION:[-1,1,1],OCEAN_COLOR:new THREE.Vector3(.004,.016,.047),SKY_COLOR:new THREE.Vector3(3.2,9.6,12.8),EXPOSURE:.1,RESOLUTION:b});e.materialOcean.uniforms.u_projectionMatrix={type:"m4",value:camera.projectionMatrix},e.materialOcean.uniforms.u_viewMatrix={type:"m4",value:camera.matrixWorldInverse},e.materialOcean.uniforms.u_cameraPosition={type:"v3",value:camera.position};var f=(new Date).getTime();e.updateOcean=function(){var a=(new Date).getTime();e.deltaTime=.001*(a-f)||0,f=a,e.render(e.deltaTime),e.overrideMaterial=e.materialOcean,e.changed&&(e.materialOcean.uniforms.u_size.value=e.size,e.materialOcean.uniforms.u_sunDirection.value.set(e.sunDirectionX,e.sunDirectionY,e.sunDirectionZ),e.materialOcean.uniforms.u_exposure.value=e.exposure,e.changed=!1),e.materialOcean.uniforms.u_normalMap.value=e.normalMapFramebuffer,e.materialOcean.uniforms.u_displacementMap.value=e.displacementMapFramebuffer,e.materialOcean.uniforms.u_projectionMatrix.value=camera.projectionMatrix,e.materialOcean.uniforms.u_viewMatrix.value=camera.matrixWorldInverse,e.materialOcean.uniforms.u_cameraPosition.value=camera.position,e.materialOcean.depthTest=!0,cameraCtrl.update()},guiOcean=guiDebug.addFolder("Ocean");var g=guiOcean.add(e,"size",100,5e3);g.onChange(function(a){this.object.size=a,this.object.changed=!0});var h=guiOcean.add(e,"choppiness",.1,4);h.onChange(function(a){this.object.choppiness=a,this.object.changed=!0});var i=guiOcean.add(e,"windX",-15,15);i.onChange(function(a){this.object.windX=a,this.object.changed=!0});var j=guiOcean.add(e,"windY",-15,15);j.onChange(function(a){this.object.windY=a,this.object.changed=!0});var k=guiOcean.add(e,"sunDirectionX",-1,1);k.onChange(function(a){this.object.sunDirectionX=a,this.object.changed=!0});var l=guiOcean.add(e,"sunDirectionY",-1,1);l.onChange(function(a){this.object.sunDirectionY=a,this.object.changed=!0});var m=guiOcean.add(e,"sunDirectionZ",-1,1);m.onChange(function(a){this.object.sunDirectionZ=a,this.object.changed=!0});var n=guiOcean.add(e,"exposure",0,.5);return n.onChange(function(a){this.object.exposure=a,this.object.changed=!0}),e}function initLensflare(){function a(a){function b(a){return--a*a*a+1}var c=world.sky.sunPosition.clone();"tollway"===currView&&(c.y+=5e4),a.position.copy(c);var d,e=2*-a.positionScreen.x,f=2*-a.positionScreen.y,g=a.lensFlares.length;for(d=0;g>d;d++){var h=a.lensFlares[d];h.rotation=0,d>0&&(h.x=a.positionScreen.x+e*h.distance,h.y=a.positionScreen.y+f*h.distance)}var i=new THREE.Vector2(a.positionScreen.x,a.positionScreen.y),j=Math.min(i.length(),1);i.normalize();var k=new THREE.Vector2(0,1),l=i.dot(k);l=Math.acos(THREE.Math.clamp(l,-1,1)),a.positionScreen.x>0&&(l*=-1),a.lensFlares[2].rotation=l,a.lensFlares[2].size=512*b(j)}var b=new THREE.LensFlare(assetManager.getTexture("lensdirtTex"),2048,0,THREE.AdditiveBlending,new THREE.Color(4473924));return b.add(assetManager.getTexture("lensFlare01Tex"),1024,0,THREE.AdditiveBlending,new THREE.Color(16777215)),b.add(assetManager.getTexture("lensFlareHoopTex"),512,1.1,THREE.AdditiveBlending,new THREE.Color(14540253)),b.position.copy(sunlight.position),b.customUpdateCallback=a,b}function onDocumentMouseMove(a){a.preventDefault(),mouse.x=a.clientX/screenWidth*2-1,mouse.y=2*-(a.clientY/screenHeight)+1,mouseDownFlag&&TWEEN.removeAll()}function onClick(a){a.preventDefault()}function onWindowResize(){screenWidth=window.innerWidth,screenHeight=window.innerHeight,camera.aspect=screenWidth/screenHeight,camera.updateProjectionMatrix(),renderer.setSize(screenWidth,screenHeight),composer.setSize(screenWidth,screenHeight),FXAApass.uniforms.resolution.value.set(1/screenWidth,1/screenHeight)}THREE.Object3D.prototype.clone=function(a,b){if(void 0===a&&(a=new THREE.Object3D),void 0===b&&(b=!0),a.name=this.name,a.up.copy(this.up),a.position.copy(this.position),a.quaternion.copy(this.quaternion),a.scale.copy(this.scale),a.renderDepth=this.renderDepth,a.rotationAutoUpdate=this.rotationAutoUpdate,a.matrix.copy(this.matrix),a.matrixWorld.copy(this.matrixWorld),a.matrixAutoUpdate=this.matrixAutoUpdate,a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,a.material&&this.material&&(a.material=this.material.clone()),a.visible=this.visible,a.castShadow=this.castShadow,a.receiveShadow=this.receiveShadow,a.frustumCulled=this.frustumCulled,a.userData=JSON.parse(JSON.stringify(this.userData)),b===!0)for(var c=0;c<this.children.length;c++){var d=this.children[c];a.add(d.clone())}return a},THREE.Object3D.prototype.setDefaultPos=function(a,b,c,d,e,f){this.position.set(a,b,c),this.oripos=this.position.clone(),this.orirot=this.rotation.clone(),d&&e&&f&&(this.rotation.set(d,e,f),this.orirot=this.rotation.clone())},THREE.Object3D.prototype.animateResetPos=function(){(this.oripos||this.orirot)&&(new TWEEN.Tween(this.position).to({x:this.oripos.x,y:this.oripos.y,z:this.oripos.z},1e3).easing(TWEEN.Easing.Quadratic.Out).start(),new TWEEN.Tween(this.rotation).to({x:this.orirot.x,y:this.orirot.y,z:this.orirot.z},1e3).easing(TWEEN.Easing.Quadratic.Out).start())},THREE.Object3D.prototype.animatePos=function(a,b,c){new TWEEN.Tween(this.position).to({x:a,y:b,z:c},1e3).easing(TWEEN.Easing.Quadratic.Out).start()},THREE.Object3D.prototype.animateY=function(a){new TWEEN.Tween(this.position).to({y:a},1e3).easing(TWEEN.Easing.Quadratic.Out).start()};var container,stats,scene,camera,cameraCtrl,renderer,world={},screenWidth=window.innerWidth,screenHeight=window.innerHeight,mouse=new THREE.Vector2(-1,-1),scene_settings={bgColor:1118483,enableShadow:!0,shadowMapType:THREE.PCFSoftShadowMap,shadowMapSize:4096,shadowDarkness:.6,maxAnisotropy:null,enableHelper:!1,enableStats:!0,enableInfoBar:!0};container=document.getElementById("canvas-container"),scene=new THREE.Scene,scene.fog=new THREE.Fog(3355460,10,1e5),camera=new THREE.PerspectiveCamera(80,window.innerWidth/window.innerHeight,10,2e6),cameraCtrl=new THREE.OrbitControls(camera,container),cameraCtrl.object.position.set(-3e3,2e3,0),cameraCtrl.update(),renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),renderer.setClearColor(scene_settings.bgColor,1),renderer.setSize(screenWidth,screenHeight),renderer.autoClear=!1,renderer.shadowMapEnabled=scene_settings.enableShadow,renderer.shadowMapType=scene_settings.shadoyMapType,scene_settings.maxAnisotropy=scene_settings.maxAnisotropy||renderer.getMaxAnisotropy(),container.appendChild(renderer.domElement),stats=new Stats,container.appendChild(stats.domElement);var grid=new THREE.GridHelper(4e3,500);grid.setColors(16746496,0),grid.material.opacity=.7,grid.material.transparent=!0,grid.position.y=-300,scene.add(grid);var axisHelper=new THREE.AxisHelper(1e3);axisHelper.position.y=1e3,scene.add(axisHelper);var gui=new dat.GUI,guiCtrl=gui.addFolder("Controls"),guiViews=guiCtrl.addFolder("Views"),guiDebug=gui.addFolder("Debug"),guiGeneral=guiDebug.addFolder("General"),guiPP=guiDebug.addFolder("Post-Processing"),guiSky,guiOcean;gui.close(),guiCtrl.open(),guiViews.open(),guiDebug.open();var debugInfo=$(".debug-info"),statsDOM=$("#stats");guiGeneral.add(scene_settings,"enableStats").name("FPS").onChange(function(a){statsDOM.css("visibility",a?"visible":"hidden")}),guiGeneral.add(scene_settings,"enableInfoBar").name("Status").onChange(function(a){debugInfo.css("visibility",a?"visible":"hidden")}),guiGeneral.add(scene_settings,"enableHelper").name("Visual Helper").onChange(toggleHelper);var debugCTGT=$(".ctgt"),debugCPOS=$(".cpos"),debugFOV=$(".fov"),debugGL=$(".debug-gl"),SHADOW_MAP_WIDTH=scene_settings.shadowMapSize,SHADOW_MAP_HEIGHT=scene_settings.shadowMapSize,sunlight=new THREE.DirectionalLight(16777215,1);sunlight.castShadow=!0,sunlight.shadowCameraNear=8e3,sunlight.shadowCameraFar=12e3,sunlight.shadowCameraLeft=-2e3,sunlight.shadowCameraRight=2e3,sunlight.shadowCameraTop=2e3,sunlight.shadowCameraBottom=-2e3,sunlight.shadowCameraVisible=!0,sunlight.shadowCameraFov=80,sunlight.shadowBias=1e-4,sunlight.shadowDarkness=scene_settings.shadowDarkness,sunlight.shadowMapWidth=SHADOW_MAP_WIDTH,sunlight.shadowMapHeight=SHADOW_MAP_HEIGHT;var sunlightColor={color:"#ffffff"},guiSunlight=guiDebug.addFolder("Sunlight");guiSunlight.add(sunlight,"intensity",0,3,.1),guiSunlight.addColor(sunlightColor,"color").name("color").onChange(updateLightCol),scene.add(sunlight);var backLight=new THREE.DirectionalLight(16777215,.5);backLight.position.set(1e3,1e3,-1500);var backLightHelper=new THREE.DirectionalLightHelper(backLight,100);scene.add(backLightHelper),scene.add(backLight);var frontLight=new THREE.DirectionalLight(16777215,2);frontLight.position.set(-3500,500,2500),scene.add(frontLight);var ambLight=new THREE.AmbientLight(328966);scene.add(ambLight),toggleHelper();var renderPass=new THREE.RenderPass(scene,camera),depthShader=THREE.ShaderLib.depthRGBA,depthUniforms=THREE.UniformsUtils.clone(depthShader.uniforms),depthMaterial=new THREE.ShaderMaterial({fragmentShader:depthShader.fragmentShader,vertexShader:depthShader.vertexShader,uniforms:depthUniforms});depthMaterial.blending=THREE.NoBlending;var depthTarget=new THREE.WebGLRenderTarget(1024,1024,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),SSAOpass=new THREE.ShaderPass(THREE.SSAOShader);SSAOpass.uniforms.tDepth.value=depthTarget,SSAOpass.uniforms.size.value.set(1024,1024),SSAOpass.uniforms.cameraNear.value=camera.near,SSAOpass.uniforms.cameraFar.value=2e4,SSAOpass.uniforms.aoClamp.value=.59,SSAOpass.uniforms.lumInfluence.value=1.06,SSAOpass.uniforms.onlyAO.value=0;var FXAApass=new THREE.ShaderPass(THREE.FXAAShader);FXAApass.uniforms.resolution.value.set(1/screenWidth,1/screenHeight);var CCpass=new THREE.ShaderPass(THREE.ColorCorrectionShader),CCNIXpass=new THREE.ShaderPass(THREE.ColorCorrectionShaderNIX),copyPass=new THREE.ShaderPass(THREE.CopyShader);copyPass.renderToScreen=!0;var composer=new THREE.EffectComposer(renderer);composer.setSize(screenWidth,screenHeight),composer.addPass(renderPass),composer.addPass(SSAOpass),composer.addPass(FXAApass),composer.addPass(CCpass),composer.addPass(CCNIXpass),composer.addPass(copyPass),guiPP.open(),guiPP.add(FXAApass,"enabled").name("FXAA");var onlyAO={value:!1},guiSSAO=guiPP.addFolder("SSAO");guiSSAO.add(SSAOpass,"enabled").name("Enable"),guiSSAO.add(onlyAO,"value").name("Show RAW").onChange(function(a){SSAOpass.uniforms.onlyAO.value=a?1:0}),guiSSAO.add(SSAOpass.uniforms.aoClamp,"value",0,1).name("Clamp"),guiSSAO.add(SSAOpass.uniforms.lumInfluence,"value",-2,2).name("LumInfluence");var guiBleach=guiPP.addFolder("Bleach Bypass & E6C41");guiBleach.add(CCNIXpass,"enabled").name("Enable"),guiBleach.add(CCNIXpass.uniforms.uOpacity,"value",0,2,.1).name("Bleach Bypass"),guiBleach.add(CCNIXpass.uniforms.uOpacity2,"value",0,2,.1).name("E6C41");var ccu=CCpass.uniforms,ccuEffect={exposure:1,powR:1,powG:1,powB:1,mulR:1,mulG:1,mulB:1},guiCC=guiPP.addFolder("Color Correction");guiCC.add(CCpass,"enabled").name("Enable"),guiCC.add(ccu.exposure,"value",0,5,.01).name("Exposure"),guiCC.add(ccuEffect,"powR",1,3,.01).onChange(adjustCC),guiCC.add(ccuEffect,"powG",1,3,.01).onChange(adjustCC),guiCC.add(ccuEffect,"powB",1,3,.01).onChange(adjustCC),guiCC.add(ccuEffect,"mulR",1,3,.01).onChange(adjustCC),guiCC.add(ccuEffect,"mulG",1,3,.01).onChange(adjustCC),guiCC.add(ccuEffect,"mulB",1,3,.01).onChange(adjustCC),adjustCC();var assetManager=function(){function a(a,b){if(b instanceof Array){for(var c=0;c<b.length;c++)if(-1!==a.indexOf(b[c]))return!0}else if(-1!==a.indexOf(b))return!0;return!1}function b(b,c){var d;return a(c,k)?(d=n.textures[b]={},d.texUrl=j+c,d.texture=null,d.type=null):a(c,m)&&(d=n.models[b]={},d.modelUrl=l+c,d.model=null),this}function c(a,b){var c=n.textures[a]={};return c.texUrl=b,c.texture=null,c.type="cube",this}function d(){return n}function e(a){return n.models[a].model}function f(a){return n.textures[a].texture}function g(a){return n.materials[a]}function h(a,b){return n.textures[a]={},n.textures[a].texture=b,this}function i(a,b){return n.materials[a]=b,this}var j="assets/",k=[".jpg",".png"],l="assets/",m=".obj",n={textures:{},models:{},materials:{}};return{addFile:b,get:d,getModel:e,getTexture:f,getMaterial:g,addMaterial:i,addTexture:h,addSkybox:c}}(),skyboxPath="assets/skybox/",skyboxFormat=".png",skyboxUrls=[skyboxPath+"px"+skyboxFormat,skyboxPath+"nx"+skyboxFormat,skyboxPath+"py"+skyboxFormat,skyboxPath+"ny"+skyboxFormat,skyboxPath+"pz"+skyboxFormat,skyboxPath+"nz"+skyboxFormat];assetManager.addSkybox("reflectionCube",skyboxUrls).addFile("emptyPlatform","platform/emptyPlatform.obj").addFile("shell","platform/platformShell.obj").addFile("shorePlatform","shore/shoreSlope.obj").addFile("shoreWaterSurfaceTex","shore/1024shoreWaterSurface.png").addFile("shoreWaterSurface","shore/shoreWaterSurface.obj").addFile("turbineBase","turbine/turbineBase.obj").addFile("propeller","turbine/propeller.obj").addFile("hubPlatform","hub/hubplatform_no_base.obj").addFile("hubWindowTex","hub/1024hubwindow.png").addFile("hubWindow","hub/hubwindow.obj").addFile("hubStreetLine","hub/hubstreetline.obj").addFile("tollway","tollway/tollway_no_base.obj").addFile("tollwayLine","tollway/tollwayline.obj").addFile("city01","city01/city01_no_base.obj").addFile("city02","city02/city02_no_base.obj").addFile("city03","city03/city03_no_base.obj").addFile("resident01","resident01/resident01_no_base.obj").addFile("resident02","resident02/resident02_no_base.obj").addFile("landfillBuildingTex","landfill/building1k.png").addFile("landfillBuilding","landfill/landfillBuilding.obj").addFile("landfillDirtTex","landfill/dirt.png").addFile("landfillDirt","landfill/landfillDirt.obj").addFile("landfillPipeTex","landfill/1024landfillPipe.png").addFile("landfillPipe","landfill/landfillPipe.obj").addFile("landfillWindowTex","landfill/1024landfillWindow.png").addFile("landfillWindow","landfill/landfillWindow.obj").addFile("watersupply","watersupply/watersupply_no_base.obj").addFile("watersupplyPipeTex","watersupply/1024watersupplyPipe.png").addFile("watersupplyPipe","watersupply/watersupplyPipe.obj").addFile("lensdirtTex","lensflare/lensdirt01.png").addFile("lensFlare01Tex","lensflare/lensflare01.png").addFile("lensFlareHoopTex","lensflare/lensflareHoop.png").addFile("oceanSurface","ocean/oceanSurfaceSubdivided.obj");var loadingBar=$("#loadingBar"),loadingScreen=$("#loadingScreen"),loadingText=$("#loadingText"),totalItems,loadedItems,loadingManager=new THREE.LoadingManager;console.time("loadingManager"),loadingManager.onProgress=function(a,b,c){totalItems=c,loadedItems=b;var d=b/c*100;loadingBar.css("width",d+"%"),loadingText.html(loadedItems+"/"+totalItems+" "+a)},loadingManager.onError=function(){console.error("Error: loading assets")},loadingManager.onLoad=function(){console.log(loadedItems+"/"+totalItems+" assets loaded"),console.timeEnd("loadingManager"),initContent(),startScene(),initDebugInfo(),render(),loadingScreen.css("display","none"),loadingBar.css("display","none"),loadingText.css("display","none")};var textureLoader=new THREE.ImageLoader(loadingManager),OBJloader=new THREE.OBJLoader(loadingManager);_.each(assetManager.get().textures,function(a){"cube"===a.type?a.texture=loadTextureCube(a.texUrl):textureLoader.load(a.texUrl,function(b){a.texture=new THREE.Texture(b),a.texture.needsUpdate=!0})}),_.each(assetManager.get().models,function(a){OBJloader.load(a.modelUrl,function(b){a.model=b.children[0],a.model.geometry.computeVertexNormals(),a.model.receiveShadow=!0,a.model.castShadow=!0})});var currView="city",viewCtrl={silhouette:animateSilhouetteView,city:animateCityView,turbines:animateTurbinesView,landfill:animateLandfillView,waterNetwork:animateWaterNetworkView,tollway:animateTollwayView,hub:animateHubView,sensor:animateSensorView};guiViews.add(viewCtrl,"city"),guiViews.add(viewCtrl,"turbines"),guiViews.add(viewCtrl,"landfill"),guiViews.add(viewCtrl,"waterNetwork"),guiViews.add(viewCtrl,"tollway"),guiViews.add(viewCtrl,"hub"),guiViews.add(viewCtrl,"sensor");var contentBar=$(".content-container");SlideShow.prototype.start=function(){function a(){b.fadeOutAll(),b._imgArr[b._currIdx]||(b._currIdx=0),$(b._imgArr[b._currIdx]).stop().fadeIn({duration:b.duration,complete:b.auto?$.proxy(b.start,b):null}),b._currIdx+=1}var b=this;this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(a,this.delay)},SlideShow.prototype.fadeOutAll=function(){this._imgArr.stop().fadeOut(this.duration)},window.addEventListener("keypress",function(a){32===a.charCode&&(a.preventDefault(),gui.closed=!gui.closed),102===a.charCode&&(a.preventDefault(),THREEx.FullScreen.request())});var mouseDownFlag=0;
document.addEventListener("mousemove",onDocumentMouseMove,!1),document.addEventListener("click",onClick,!1),document.addEventListener("mousedown",function(){mouseDownFlag=1}),document.addEventListener("mouseup",function(){mouseDownFlag=0}),window.addEventListener("resize",onWindowResize,!1);
//# sourceMappingURL=smart-city-app.min.js.map